<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>D&D 5e Encounter Generator</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background: #0b0d12; color: #e9eefc; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 18px; }
    h1 { font-size: 20px; margin: 0 0 10px; }
    .card { background: #121726; border: 1px solid #222a40; border-radius: 14px; padding: 14px; margin: 12px 0; }
    label { display: block; font-size: 12px; opacity: .9; margin-bottom: 6px; }
    input, select, button { width: 100%; box-sizing: border-box; padding: 10px 12px; border-radius: 10px; border: 1px solid #2a3558; background: #0f1422; color: #e9eefc; }
    button { cursor: pointer; border: 1px solid #3a4a7a; background: #1a2340; font-weight: 600; }
    button:hover { filter: brightness(1.08); }
    .grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; }
    .span2 { grid-column: span 2; }
    .span3 { grid-column: span 3; }
    .span6 { grid-column: span 6; }
    .pill { display: inline-block; padding: 4px 8px; border-radius: 999px; border: 1px solid #2a3558; font-size: 12px; margin-right: 8px; }
    .muted { opacity: .85; font-size: 13px; line-height: 1.35; }
    ul { margin: 10px 0 0; padding-left: 18px; }
    li { margin: 6px 0; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; }
    .row > div { flex: 1 1 220px; }
    .warn { color: #ffd18b; }
    .ok { color: #a7ffb1; }
    .bad { color: #ff9fa6; }
    .small { font-size: 12px; opacity: .85; }
    .footer { opacity: .7; font-size: 12px; margin-top: 10px; }
    @media (max-width: 900px) {
      .grid { grid-template-columns: repeat(2, 1fr); }
      .span2,.span3,.span6 { grid-column: span 2; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>D&D 5e Encounter Generator (DMG XP math)</h1>

    <div class="card">
      <div class="grid">
        <div class="span2">
          <label>Party Level</label>
          <input id="partyLevel" type="number" min="1" max="20" value="5" />
        </div>
        <div class="span2">
          <label>Party Size</label>
          <input id="partySize" type="number" min="1" max="10" value="4" />
        </div>
        <div class="span2">
          <label>Difficulty</label>
          <select id="difficulty">
            <option value="easy">Easy</option>
            <option value="medium" selected>Medium</option>
            <option value="hard">Hard</option>
            <option value="deadly">Deadly</option>
          </select>
        </div>

        <div class="span3">
          <label>Theme (optional)</label>
          <select id="theme">
            <option value="any" selected>Any</option>
            <option value="undead">Undead</option>
            <option value="humanoid">Humanoid</option>
            <option value="beast">Beast</option>
            <option value="giant">Giant</option>
            <option value="fiend">Fiend</option>
            <option value="dragon">Dragon-ish</option>
            <option value="construct">Construct</option>
          </select>
          <div class="small">Uses the built-in mini monster list (edit/expand anytime).</div>
        </div>

        <div class="span3">
          <label>Style</label>
          <select id="style">
            <option value="mixed" selected>Mixed (default)</option>
            <option value="boss">Boss + Minions</option>
            <option value="horde">Horde (more bodies)</option>
          </select>
          <div class="small">Boss mode tries to pick one higher-CR creature plus smaller support.</div>
        </div>

        <div class="span6">
          <button id="genBtn">Generate Encounter</button>
        </div>
      </div>
    </div>

    <div class="card" id="result">
      <div class="muted">Click <b>Generate Encounter</b> to get a fight.</div>
    </div>

    <div class="footer">
      Tip: Expand the monster list in the code (search for <b>MONSTERS</b>). You can paste in your own homebrew too.
    </div>
  </div>

<script>
/**
 * DMG XP thresholds per character by level (Easy, Medium, Hard, Deadly)
 */
const XP_THRESHOLDS = {
  1:[25,50,75,100], 2:[50,100,150,200], 3:[75,150,225,400], 4:[125,250,375,500],
  5:[250,500,750,1100], 6:[300,600,900,1400], 7:[350,750,1100,1700], 8:[450,900,1400,2100],
  9:[550,1100,1600,2400], 10:[600,1200,1900,2800], 11:[800,1600,2400,3600], 12:[1000,2000,3000,4500],
  13:[1100,2200,3400,5100], 14:[1250,2500,3800,5700], 15:[1400,2800,4300,6400], 16:[1600,3200,4800,7200],
  17:[2000,3900,5900,8800], 18:[2100,4200,6300,9500], 19:[2400,4900,7300,10900], 20:[2800,5700,8500,12700]
};

/**
 * DMG XP per CR (core table)
 * (Includes fractional CRs commonly used)
 */
const CR_XP = new Map([
  ["0",10],["1/8",25],["1/4",50],["1/2",100],
  ["1",200],["2",450],["3",700],["4",1100],["5",1800],["6",2300],["7",2900],["8",3900],["9",5000],["10",5900],
  ["11",7200],["12",8400],["13",10000],["14",11500],["15",13000],["16",15000],["17",18000],["18",20000],["19",22000],["20",25000],
  ["21",33000],["22",41000],["23",50000],["24",62000],["25",75000],["26",90000],["27",105000],["28",120000],["29",135000],["30",155000],
]);

/**
 * DMG monster-number multipliers:
 * 1:1, 2:1.5, 3-6:2, 7-10:2.5, 11-14:3, 15+:4
 * Party size adjustment:
 * - If party size <= 2, increase multiplier one step
 * - If party size >= 6, decrease multiplier one step
 */
function baseMultiplier(monsterCount){
  if (monsterCount === 1) return 1;
  if (monsterCount === 2) return 1.5;
  if (monsterCount >= 3 && monsterCount <= 6) return 2;
  if (monsterCount >= 7 && monsterCount <= 10) return 2.5;
  if (monsterCount >= 11 && monsterCount <= 14) return 3;
  return 4;
}

function adjustedMultiplier(monsterCount, partySize){
  const steps = [1, 1.5, 2, 2.5, 3, 4];
  let m = baseMultiplier(monsterCount);
  let idx = steps.indexOf(m);
  if (partySize <= 2) idx = Math.min(idx + 1, steps.length - 1);
  if (partySize >= 6) idx = Math.max(idx - 1, 0);
  return steps[idx];
}

/**
 * Mini monster list (SRD-ish + common picks).
 * Add more entries whenever you want.
 * Each monster: { name, cr, tags: [] }
 */
const MONSTERS = [
  // Undead
  {name:"Skeleton", cr:"1/4", tags:["undead"]},
  {name:"Zombie", cr:"1/4", tags:["undead"]},
  {name:"Ghoul", cr:"1", tags:["undead"]},
  {name:"Wight", cr:"3", tags:["undead"]},
  {name:"Wraith", cr:"5", tags:["undead"]},

  // Humanoids / Cult-ish / Soldiers
  {name:"Bandit", cr:"1/8", tags:["humanoid"]},
  {name:"Thug", cr:"1/2", tags:["humanoid"]},
  {name:"Scout", cr:"1/2", tags:["humanoid"]},
  {name:"Cultist", cr:"1/8", tags:["humanoid"]},
  {name:"Cult Fanatic", cr:"2", tags:["humanoid"]},
  {name:"Acolyte", cr:"1/4", tags:["humanoid"]},
  {name:"Veteran", cr:"3", tags:["humanoid"]},
  {name:"Knight", cr:"3", tags:["humanoid"]},
  {name:"Mage", cr:"6", tags:["humanoid"]},

  // Beasts
  {name:"Wolf", cr:"1/4", tags:["beast"]},
  {name:"Dire Wolf", cr:"1", tags:["beast"]},
  {name:"Brown Bear", cr:"1", tags:["beast"]},

  // Giants / Brutes
  {name:"Ogre", cr:"2", tags:["giant"]},
  {name:"Troll", cr:"5", tags:["giant"]},
  {name:"Hill Giant", cr:"5", tags:["giant"]},

  // Fiends
  {name:"Imp", cr:"1", tags:["fiend"]},
  {name:"Spined Devil", cr:"2", tags:["fiend"]},
  {name:"Barbed Devil", cr:"5", tags:["fiend"]},

  // Dragon-ish (stand-ins)
  {name:"Wyvern", cr:"6", tags:["dragon"]},
  {name:"Young White Dragon", cr:"6", tags:["dragon"]},

  // Constructs
  {name:"Animated Armor", cr:"1", tags:["construct"]},
  {name:"Helmed Horror", cr:"4", tags:["construct"]},
];

/** Helpers */
function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function sum(arr){ return arr.reduce((a,b)=>a+b,0); }

function budgetFor(level, size, diff){
  const idx = {easy:0, medium:1, hard:2, deadly:3}[diff];
  const per = XP_THRESHOLDS[level]?.[idx];
  if (!per) throw new Error("Level out of range");
  return per * size;
}

function xpForCR(cr){
  const xp = CR_XP.get(cr);
  if (xp == null) throw new Error("Unknown CR: " + cr);
  return xp;
}

function filterByTheme(theme){
  if (theme === "any") return MONSTERS.slice();
  return MONSTERS.filter(m => m.tags.includes(theme));
}

function describeDifficultyRatio(adjustedXp, budget){
  const ratio = adjustedXp / budget;
  if (ratio < 0.85) return {label:"Below target", cls:"warn"};
  if (ratio <= 1.15) return {label:"On target", cls:"ok"};
  return {label:"Spicy (over target)", cls:"bad"};
}

/**
 * Generate encounter:
 * Build a list of monsters whose *adjusted XP* aims near budget.
 * We try several random attempts and keep the best.
 */
function generateEncounter({level, size, difficulty, theme, style}){
  const pool = filterByTheme(theme);
  if (pool.length === 0) throw new Error("No monsters for this theme. Expand MONSTERS list.");

  const budget = budgetFor(level, size, difficulty);

  // Determine desired monster count range based on style
  let minCount = 1, maxCount = 6;
  if (style === "boss") { minCount = 2; maxCount = 6; }
  if (style === "horde") { minCount = 4; maxCount = 10; }

  const attempts = 900;
  let best = null;

  for (let i=0;i<attempts;i++){
    const count = randInt(minCount, maxCount);

    let picks = [];

    if (style === "boss") {
      // Boss: choose a higher-CR monster as anchor, then fill with smaller ones.
      // Pick boss from top 35% CR XP values in pool (rough heuristic)
      const sorted = pool.slice().sort((a,b)=>xpForCR(a.cr)-xpForCR(b.cr));
      const bossCandidates = sorted.slice(Math.floor(sorted.length*0.65));
      const boss = pick(bossCandidates.length ? bossCandidates : sorted);
      picks.push(boss);

      // Fill with minions biased toward lower CR
      const minionPool = sorted.slice(0, Math.max(1, Math.floor(sorted.length*0.6)));
      while (picks.length < count){
        picks.push(pick(minionPool));
      }
    } else if (style === "horde") {
      // Horde: bias lower CR more heavily
      const low = pool.slice().sort((a,b)=>xpForCR(a.cr)-xpForCR(b.cr));
      const lowPool = low.slice(0, Math.max(1, Math.floor(low.length*0.7)));
      for (let k=0;k<count;k++) picks.push(pick(lowPool));
    } else {
      for (let k=0;k<count;k++) picks.push(pick(pool));
    }

    const rawXp = sum(picks.map(m=>xpForCR(m.cr)));
    const mult = adjustedMultiplier(picks.length, size);
    const adjustedXp = rawXp * mult;

    // Score: closeness to target, with a slight penalty if too far over.
    const diffFromTarget = Math.abs(adjustedXp - budget);
    const overPenalty = adjustedXp > budget ? (adjustedXp - budget) * 1.15 : 0;
    const score = diffFromTarget + overPenalty;

    if (!best || score < best.score){
      best = {picks, rawXp, mult, adjustedXp, budget, score};
    }
  }

  // Combine same monsters into counts
  const counts = new Map();
  for (const m of best.picks){
    counts.set(m.name, (counts.get(m.name) || 0) + 1);
  }

  const lines = [];
  for (const [name, qty] of counts.entries()){
    const sample = best.picks.find(x => x.name === name);
    lines.push({name, qty, cr: sample.cr, xpEach: xpForCR(sample.cr), tags: sample.tags});
  }
  // Sort by CR descending for nicer display
  lines.sort((a,b)=>xpForCR(b.cr)-xpForCR(a.cr));

  return { ...best, lines };
}

/** UI */
const result = document.getElementById("result");
document.getElementById("genBtn").addEventListener("click", () => {
  try {
    const level = Number(document.getElementById("partyLevel").value);
    const size = Number(document.getElementById("partySize").value);
    const difficulty = document.getElementById("difficulty").value;
    const theme = document.getElementById("theme").value;
    const style = document.getElementById("style").value;

    if (!Number.isFinite(level) || level < 1 || level > 20) throw new Error("Party level must be 1–20.");
    if (!Number.isFinite(size) || size < 1 || size > 10) throw new Error("Party size must be 1–10.");

    const enc = generateEncounter({level, size, difficulty, theme, style});
    const vibe = describeDifficultyRatio(enc.adjustedXp, enc.budget);

    result.innerHTML = `
      <div class="row">
        <div>
          <span class="pill">Level ${level}</span>
          <span class="pill">${size} players</span>
          <span class="pill">${difficulty.toUpperCase()}</span>
          <span class="pill">Theme: ${theme}</span>
          <span class="pill">Style: ${style}</span>
        </div>
      </div>

      <div style="margin-top:10px" class="muted">
        <b>XP Budget:</b> ${enc.budget.toFixed(0)}<br/>
        <b>Raw XP:</b> ${enc.rawXp.toFixed(0)}<br/>
        <b>Multiplier:</b> ×${enc.mult} (for ${enc.picks.length} monsters, party size adjusted)<br/>
        <b>Adjusted XP:</b> ${enc.adjustedXp.toFixed(0)} — <span class="${vibe.cls}"><b>${vibe.label}</b></span>
      </div>

      <ul>
        ${enc.lines.map(x => `
          <li>
            <b>${x.qty}× ${x.name}</b>
            <span class="muted"> (CR ${x.cr}, ${x.xpEach} XP each)</span>
            <span class="small"> — ${x.tags.join(", ")}</span>
          </li>
        `).join("")}
      </ul>

      <div class="muted" style="margin-top:10px">
        DM tip: If you want this nastier without changing XP, add terrain pressure (cover, choke points, darkness, traps).
      </div>
    `;
  } catch (e) {
    result.innerHTML = `<div class="muted"><span class="bad"><b>Error:</b></span> ${e.message}</div>`;
  }
});

// Auto-generate once on load
document.getElementById("genBtn").click();
</script>
</body>
</html
